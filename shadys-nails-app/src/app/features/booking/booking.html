<div class="booking-page">
    <div class="booking-container">
        <!-- Header -->
        <div class="booking-header">
            <button class="btn-back" (click)="cancel()">
                <span class="icon">‚Üê</span> Volver
            </button>
            <h1>‚ú® Agendar tu Cita</h1>
            <p class="subtitle">Solo falta poco para consentirte</p>
        </div>

        <form [formGroup]="bookingForm" (ngSubmit)="onSubmit()" class="booking-form">

            <!-- SECCI√ìN 1: SERVICIO SELECCIONADO -->
            <div class="section-card service-section" *ngIf="selectedService">
                <div class="section-header">
                    <span class="step-badge">1</span>
                    <h2>Servicio Seleccionado</h2>
                </div>

                <div class="selected-service-card">
                    <div class="service-icon">üíÖ</div>
                    <div class="service-info">
                        <h3>{{ selectedService.name }}</h3>
                        <p class="price-tag">${{ selectedService.price | number }}</p>
                    </div>
                    <div class="service-meta">
                        <span class="duration">‚è±Ô∏è {{ selectedService.duration_minutes }} min</span>
                    </div>
                    <button type="button" class="btn-change" (click)="changeService()">Cambiar</button>
                </div>
            </div>

            <!-- SECCI√ìN 2: ADICIONALES -->
            <div class="section-card additional-section" *ngIf="selectedService">
                <div class="section-header">
                    <span class="step-badge">2</span>
                    <h2>¬øAlgo extra? (Opcional)</h2>
                </div>

                <div class="additionals-grid">
                    <!-- Opci√≥n Ninguno -->
                    <div class="additional-card" [class.selected]="!bookingForm.get('additionalId')?.value"
                        (click)="bookingForm.patchValue({additionalId: ''}); loadAvailableSlots()">
                        <div class="check-circle"></div>
                        <div class="content">
                            <h4>Solo el servicio</h4>
                            <p>Sin adicionales</p>
                        </div>
                    </div>

                    <!-- Lista de Adicionales -->
                    <div *ngFor="let additional of additionals" class="additional-card"
                        [class.selected]="bookingForm.get('additionalId')?.value == additional.id"
                        (click)="bookingForm.patchValue({additionalId: additional.id}); loadAvailableSlots()">
                        <div class="check-circle"></div>
                        <div class="content">
                            <h4>{{ additional.name }}</h4>
                            <p class="meta">+{{ additional.extra_duration }} min ‚Ä¢ +${{ additional.price | number }}</p>
                        </div>
                    </div>
                </div>
            </div>

            <!-- SECCI√ìN 3: FECHA -->
            <div class="section-card date-section" *ngIf="selectedService">
                <div class="section-header">
                    <span class="step-badge">3</span>
                    <h2>Elige el d√≠a</h2>
                </div>

                <div class="calendar-scroll-wrapper">
                    <div class="calendar-scroll">
                        <div *ngFor="let day of calendarDays" class="date-card" [class.selected]="day.isSelected"
                            [class.today]="day.isToday" (click)="selectDate(day)">
                            <span class="day-name">{{ day.dayName }}</span>
                            <span class="day-number">{{ day.day }}</span>
                            <span class="month-name">{{ day.monthName }}</span>
                            <div class="selection-indicator"></div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- SECCI√ìN 4: HORA -->
            <div class="section-card time-section" *ngIf="selectedDate">
                <div class="section-header">
                    <span class="step-badge">4</span>
                    <h2>Selecciona la hora</h2>
                </div>

                <div class="loading-slots" *ngIf="loadingSlots">
                    <div class="spinner"></div> Buscando horarios...
                </div>

                <div class="empty-slots" *ngIf="!loadingSlots && availableSlots.length === 0">
                    <span class="icon">üìÖ</span>
                    <p>No hay citas disponibles para esta fecha.</p>
                    <button type="button" class="btn-link">Prueba otro d√≠a</button>
                </div>

                <div class="time-slots-container" *ngIf="!loadingSlots && availableSlots.length > 0">
                    <div *ngFor="let group of getTimeSlotGroups()" class="time-group">
                        <h3 class="group-title">
                            <span class="icon">{{ group.label.includes('Ma√±ana') ? 'üåÖ' : 'üåÜ' }}</span>
                            {{ group.label }}
                        </h3>
                        <div class="slots-grid">
                            <button type="button" *ngFor="let slot of group.slots" class="time-pill"
                                [class.selected]="isTimeSelected(slot.time)" (click)="selectTime(slot)">
                                {{ slot.time }}
                            </button>
                        </div>
                    </div>
                </div>
            </div>

            <!-- SECCI√ìN 5: CONFIRMACI√ìN -->
            <div class="section-card confirm-section" *ngIf="bookingForm.get('time')?.value">
                <div class="section-header">
                    <span class="step-badge">5</span>
                    <h2>Confirmaci√≥n</h2>
                </div>

                <div class="notes-field">
                    <label>¬øAlguna nota o preferencia especial?</label>
                    <textarea formControlName="notes" placeholder="Ej: Quiero un dise√±o de flores..."></textarea>
                </div>

                <div class="summary-total">
                    <div class="total-row">
                        <span>Total estimado:</span>
                        <span class="amount">{{ getEstimatedTotal() }}</span>
                    </div>
                </div>

                <button type="submit" class="btn-confirm-booking" [disabled]="bookingForm.invalid || loading">
                    <span *ngIf="!loading">‚ú® Confirmar Reserva</span>
                    <span *ngIf="loading" class="spin">‚Üª</span>
                </button>
            </div>

        </form>
    </div>
</div>